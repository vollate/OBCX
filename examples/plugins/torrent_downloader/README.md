# Torrent Downloader Plugin

ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„Telegram torrentä¸‹è½½æ’ä»¶ï¼Œæ”¯æŒå®æ—¶è¿›åº¦æŸ¥è¯¢ã€‚

## æ ¸å¿ƒåŠŸèƒ½

1. **è‡ªåŠ¨ä¸‹è½½**
   - ç£åŠ›é“¾æ¥ï¼ˆmagnet:?å¼€å¤´ï¼‰
   - .torrentæ–‡ä»¶ï¼ˆä½œä¸ºé™„ä»¶å‘é€ï¼‰

2. **å®æ—¶è¿›åº¦è·Ÿè¸ª** â­ æ–°åŠŸèƒ½
   - ä½¿ç”¨ `/status` å‘½ä»¤æŸ¥çœ‹æ‰€æœ‰æ´»è·ƒä¸‹è½½
   - æ˜¾ç¤ºè¿›åº¦æ¡ã€é€Ÿåº¦ã€ETAç­‰è¯¦ç»†ä¿¡æ¯

3. **è‡ªåŠ¨ä¸Šä¼ **
   - ä½¿ç”¨rcloneä¸Šä¼ åˆ°Google Drive
   - è¿”å›åˆ†äº«é“¾æ¥

4. **å®Œå…¨éš”ç¦»**
   - æ¯ä¸ªä¸‹è½½ç‹¬ç«‹çš„aria2cè¿›ç¨‹
   - ä¸ä¸åå°RPC serverå†²çª

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
# å®‰è£…aria2c
sudo apt install aria2

# å®‰è£…rclone
curl https://rclone.org/install.sh | sudo bash

# é…ç½®rclone
rclone config
# åˆ›å»ºåä¸º "gdrive" çš„Google Drive remote
```

### 2. é…ç½®æ’ä»¶

åœ¨ä½ çš„é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ï¼š

```toml
[bots.telegram_bot]
plugins = ["torrent_downloader"]

[plugins.torrent_downloader]
enabled = true
callbacks = ["on_message"]

[plugins.torrent_downloader.config]
download_dir = "/tmp/torrent_downloads"
rclone_remote = "gdrive:"
rclone_path = "Torrents"
aria2c_options = "--seed-time=0 --max-connection-per-server=16"
max_concurrent_downloads = 3
```

### 3. åˆ›å»ºä¸‹è½½ç›®å½•

```bash
mkdir -p /tmp/torrent_downloads
```

## ä½¿ç”¨æ–¹æ³•

### ä¸‹è½½æ–‡ä»¶

**å‘é€ç£åŠ›é“¾æ¥ï¼š**
```
magnet:?xt=urn:btih:c9e15763f722f23e98a29decdfae341b98d53056&dn=Example
```

**å‘é€.torrentæ–‡ä»¶ï¼š**
- ç›´æ¥å°†.torrentæ–‡ä»¶ä½œä¸ºé™„ä»¶å‘é€

Botä¼šå›å¤ï¼š
1. "å¼€å§‹ä¸‹è½½ç£åŠ›é“¾æ¥..." / "å¼€å§‹ä¸‹è½½torrentæ–‡ä»¶..."
2. "ä¸‹è½½å®Œæˆï¼Œå¼€å§‹ä¸Šä¼ åˆ°Google Drive..."
3. "ä¸Šä¼ å®Œæˆï¼é“¾æ¥: https://..."

### æŸ¥çœ‹è¿›åº¦ â­

å‘é€å‘½ä»¤ï¼š
```
/status
```

è¿”å›ç¤ºä¾‹ï¼š
```
ğŸ“Š ä¸‹è½½ä»»åŠ¡çŠ¶æ€

ä»»åŠ¡ #1: debian-12.0.0-amd64.iso
â”œâ”€ è¿›åº¦: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 45% (450.5MB / 1.0GB)
â”œâ”€ é€Ÿåº¦: 5.2MB/s
â””â”€ é¢„è®¡: å‰©ä½™ 2åˆ†30ç§’

ä»»åŠ¡ #2: ubuntu-22.04.torrent
â”œâ”€ è¿›åº¦: â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 15% (150.2MB / 1.0GB)
â”œâ”€ é€Ÿåº¦: 3.8MB/s
â””â”€ é¢„è®¡: å‰©ä½™ 3åˆ†45ç§’

æ€»è®¡: 2ä¸ªæ´»è·ƒä»»åŠ¡
```

### è¿›åº¦ä¿¡æ¯è¯´æ˜

- **è¿›åº¦æ¡**: 10ä¸ªå­—ç¬¦çš„å¯è§†åŒ–è¿›åº¦ï¼ˆâ–ˆ = å·²å®Œæˆï¼Œâ–‘ = æœªå®Œæˆï¼‰
- **ç™¾åˆ†æ¯”**: å½“å‰ä¸‹è½½å®Œæˆç™¾åˆ†æ¯”
- **å·²ä¸‹è½½/æ€»å¤§å°**: æ ¼å¼åŒ–çš„æ–‡ä»¶å¤§å°ï¼ˆè‡ªåŠ¨é€‰æ‹©B/KB/MB/GBï¼‰
- **é€Ÿåº¦**: å®æ—¶ä¸‹è½½é€Ÿåº¦
- **é¢„è®¡**: åŸºäºå½“å‰é€Ÿåº¦è®¡ç®—çš„å‰©ä½™æ—¶é—´

### ä»»åŠ¡çŠ¶æ€

- **å‡†å¤‡ä¸­**: æ­£åœ¨è¿æ¥peersï¼Œå°šæœªå¼€å§‹ä¸‹è½½
- **ä¸‹è½½ä¸­**: æ­£å¸¸ä¸‹è½½ï¼Œæ˜¾ç¤ºè¯¦ç»†è¿›åº¦
- **è®¡ç®—ä¸­**: é€Ÿåº¦æˆ–ETAæš‚æ—¶æ— æ³•è®¡ç®—

## å·¥ä½œåŸç†

### ç£åŠ›é“¾æ¥æµç¨‹
```
ç”¨æˆ·å‘é€ magnet:?...
  â†“
æ’ä»¶è¯†åˆ«å¹¶æå–é“¾æ¥
  â†“
aria2c --log=task.log magnet:?...  (ç‹¬ç«‹è¿›ç¨‹)
  â†“
ä¸‹è½½å®Œæˆ â†’ ä¸Šä¼ Google Drive â†’ è¿”å›é“¾æ¥
```

### Torrentæ–‡ä»¶æµç¨‹
```
ç”¨æˆ·å‘é€ .torrent æ–‡ä»¶
  â†“
ä»Telegramä¸‹è½½åˆ°æœ¬åœ° â†’ /tmp/xxx.torrent
  â†“
aria2c --log=task.log /tmp/xxx.torrent  (ç‹¬ç«‹è¿›ç¨‹)
  â†“
ä¸‹è½½å®Œæˆ â†’ ä¸Šä¼ Google Drive â†’ è¿”å›é“¾æ¥
```

### è¿›åº¦è·Ÿè¸ªåŸç†

1. aria2cå†™å…¥æ—¥å¿—æ–‡ä»¶ï¼ˆ`--log` å‚æ•°ï¼‰
2. ç”¨æˆ·å‘é€ `/status` å‘½ä»¤
3. æ’ä»¶è§£ææ‰€æœ‰ä»»åŠ¡çš„æ—¥å¿—æ–‡ä»¶
4. æå–è¿›åº¦ä¿¡æ¯å¹¶æ ¼å¼åŒ–
5. è¿”å›ç¾è§‚çš„è¿›åº¦æŠ¥å‘Š

## é…ç½®é€‰é¡¹

| é€‰é¡¹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `download_dir` | `/tmp/torrent_downloads` | ä¸´æ—¶ä¸‹è½½ç›®å½• |
| `rclone_remote` | `gdrive:` | rcloneè¿œç¨‹åç§°ï¼ˆéœ€å…ˆé…ç½®ï¼‰ |
| `rclone_path` | `Torrents` | Google Driveä¸­çš„è·¯å¾„ |
| `aria2c_options` | `--seed-time=0` | aria2cé¢å¤–é€‰é¡¹ |
| `max_concurrent_downloads` | `3` | æœ€å¤§å¹¶å‘ä¸‹è½½æ•° |
| `ipv6_only` | `true` | åªä½¿ç”¨IPv6ï¼ˆæ¨èï¼‰ â­ |
| `use_public_trackers` | `true` | ä½¿ç”¨å…¬å…±trackeråˆ—è¡¨ï¼ˆæ¨èï¼‰ â­ |

### IPv6ä¸“ç”¨æ¨¡å¼ â­

**å¼ºçƒˆæ¨èå¼€å¯ï¼**

```toml
ipv6_only = true
```

**ä¼˜åŠ¿**ï¼š
- ğŸš€ æ›´å¿«çš„è¿æ¥é€Ÿåº¦ï¼ˆIPv6é€šå¸¸å»¶è¿Ÿæ›´ä½ï¼‰
- ğŸŒ é¿å…IPv4é™é€Ÿï¼ˆéƒ¨åˆ†trackerå¯¹IPv4æœ‰é€Ÿåº¦é™åˆ¶ï¼‰
- ğŸ“ˆ æ›´å¤šå¯ç”¨peersï¼ˆæ•™è‚²ç½‘IPv6èµ„æºä¸°å¯Œï¼‰
- âœ… ç»•è¿‡æŸäº›ISPçš„IPv4æµé‡é™åˆ¶

**å‰ææ¡ä»¶**ï¼š
- æœåŠ¡å™¨å¿…é¡»æœ‰IPv6åœ°å€
- ä½¿ç”¨ `ip a` æŸ¥çœ‹æ˜¯å¦æœ‰ `inet6` åœ°å€

### å…¬å…±Trackeråˆ—è¡¨ â­

**å¼ºçƒˆæ¨èå¼€å¯ï¼**

```toml
use_public_trackers = true
```

**å†…ç½®20+ä¸ªé«˜è´¨é‡tracker**ï¼ŒåŒ…æ‹¬ï¼š
- UDP trackersï¼ˆä¸»è¦ï¼‰
- HTTP/HTTPS trackersï¼ˆå¤‡ç”¨ï¼‰
- IPv6ä¸“ç”¨trackers

**æ•ˆæœå¯¹æ¯”**ï¼š

| å¯¹æ¯”é¡¹ | ä¸ä½¿ç”¨å…¬å…±tracker | ä½¿ç”¨å…¬å…±tracker |
|--------|------------------|----------------|
| å¯ç”¨peersæ•°é‡ | 5-20 | 100+ |
| ä¸‹è½½å¼€å§‹æ—¶é—´ | 1-5åˆ†é’Ÿ | 5-30ç§’ |
| å¹³å‡é€Ÿåº¦ | 1-3 MB/s | 5-15 MB/s |
| è¿æ¥æˆåŠŸç‡ | 60% | 95%+ |

**Trackeræ¥æº**ï¼š
- https://github.com/ngosang/trackerslist
- å®šæœŸéªŒè¯å¯ç”¨æ€§
- ä¼˜å…ˆé€‰æ‹©ä½å»¶è¿Ÿtracker

### aria2cé€‰é¡¹è¯´æ˜

æ’ä»¶è‡ªåŠ¨æ·»åŠ çš„é€‰é¡¹ï¼ˆä¸è¦åœ¨configä¸­é‡å¤ï¼‰ï¼š
- `--no-conf` - ä¸åŠ è½½é»˜è®¤é…ç½®
- `--enable-rpc=false` - ç¦ç”¨RPC
- `--log=<path>` - æ—¥å¿—æ–‡ä»¶è·¯å¾„
- `--log-level=notice` - æ—¥å¿—çº§åˆ«

å¯è‡ªå®šä¹‰çš„é€‰é¡¹ï¼š
```toml
# åŸºç¡€é…ç½®
aria2c_options = "--seed-time=0 --max-connection-per-server=16"

# é«˜é€Ÿä¸‹è½½
aria2c_options = "--seed-time=0 --max-connection-per-server=32 --split=32"

# é™é€Ÿä¸‹è½½ï¼ˆé¿å…å æ»¡å¸¦å®½ï¼‰
aria2c_options = "--seed-time=0 --max-download-limit=5M"
```

## è¿›ç¨‹éš”ç¦»ä¿è¯

æ¯ä¸ªä¸‹è½½ä»»åŠ¡éƒ½æ˜¯å®Œå…¨ç‹¬ç«‹çš„aria2cè¿›ç¨‹ï¼š

```bash
# æŸ¥çœ‹è¿›ç¨‹
ps aux | grep aria2c

# ä½ ä¼šçœ‹åˆ°ï¼š
# ä½ çš„RPC:    aria2c --enable-rpc --rpc-listen-port=6800
# ä»»åŠ¡1:      aria2c --no-conf --enable-rpc=false --log=...
# ä»»åŠ¡2:      aria2c --no-conf --enable-rpc=false --log=...
```

**ä¿è¯**ï¼š
- âœ… ä¸ä¼šç«¯å£å†²çª
- âœ… ä¸ä¼šé…ç½®å†²çª
- âœ… ä¸‹è½½å®Œæˆè‡ªåŠ¨æ¸…ç†
- âœ… æ”¯æŒä»»æ„å¹¶å‘æ•°é‡

## æ•…éšœæ’æŸ¥

### /status æ˜¾ç¤º"å‡†å¤‡ä¸­"å¾ˆä¹…

**åŸå› **ï¼šaria2cæ­£åœ¨è¿æ¥peers
**è§£å†³**ï¼šç­‰å¾…æˆ–æ£€æŸ¥ç½‘ç»œè¿æ¥

### è¿›åº¦ä¿¡æ¯ä¸å‡†ç¡®

**åŸå› **ï¼šæ—¥å¿—æ–‡ä»¶å°šæœªæ›´æ–°
**è§£å†³**ï¼šç­‰å¾…å‡ ç§’åå†æ¬¡æŸ¥è¯¢

### "å½“å‰æ²¡æœ‰æ´»è·ƒçš„ä¸‹è½½ä»»åŠ¡"

**åŸå› **ï¼šä¸‹è½½å·²å®Œæˆæˆ–å¤±è´¥
**è§£å†³**ï¼š
1. æ£€æŸ¥æ˜¯å¦æ”¶åˆ°ä¸Šä¼ å®Œæˆæ¶ˆæ¯
2. æŸ¥çœ‹botæ—¥å¿—è·å–é”™è¯¯ä¿¡æ¯

### ä¸‹è½½é€Ÿåº¦ä¸º0

**åŸå› **ï¼šå¯èƒ½æ˜¯ä»¥ä¸‹æƒ…å†µ
1. åˆšå¼€å§‹ä¸‹è½½ï¼Œæ­£åœ¨å»ºç«‹è¿æ¥
2. ç£åŠ›é“¾æ¥æ— å¯ç”¨peers
3. ç½‘ç»œé—®é¢˜

**è§£å†³**ï¼š
```bash
# æŸ¥çœ‹aria2cæ—¥å¿—
tail -f /tmp/torrent_downloads/dl_1/aria2c.log
```

## ç›‘æ§å’Œè°ƒè¯•

### å®æ—¶æŸ¥çœ‹æ—¥å¿—

```bash
# æŸ¥çœ‹ç‰¹å®šä»»åŠ¡çš„aria2cæ—¥å¿—
tail -f /tmp/torrent_downloads/dl_1/aria2c.log

# æŸ¥çœ‹botæ—¥å¿—
tail -f your_bot.log | grep -i torrent
```

### æŸ¥çœ‹æ´»è·ƒè¿›ç¨‹

```bash
# æŸ¥çœ‹æ‰€æœ‰ä¸‹è½½è¿›ç¨‹
ps aux | grep "aria2c.*--no-conf"

# ç»Ÿè®¡æ•°é‡
ps aux | grep -c "[a]ria2c.*--no-conf"
```

### ç£ç›˜ä½¿ç”¨ç›‘æ§

```bash
# æŸ¥çœ‹ä¸‹è½½ç›®å½•å¤§å°
du -sh /tmp/torrent_downloads/*

# å®æ—¶ç›‘æ§
watch -n 5 'du -sh /tmp/torrent_downloads/*'
```

## æ€§èƒ½ä¼˜åŒ–

### æé«˜ä¸‹è½½é€Ÿåº¦

```toml
# å¢åŠ è¿æ¥æ•°å’Œåˆ†ç‰‡
aria2c_options = "--seed-time=0 --max-connection-per-server=32 --split=32 --min-split-size=1M"
```

### é™åˆ¶å¸¦å®½ä½¿ç”¨

```toml
# é™åˆ¶ä¸‹è½½é€Ÿåº¦ä¸º10MB/s
aria2c_options = "--seed-time=0 --max-download-limit=10M"
```

### å¢åŠ å¹¶å‘ä»»åŠ¡

```toml
# å…è®¸åŒæ—¶5ä¸ªä¸‹è½½
max_concurrent_downloads = 5
```

## ä½¿ç”¨ç¤ºä¾‹

### å…¸å‹ä¸‹è½½æµç¨‹

```
ç”¨æˆ·: magnet:?xt=urn:btih:abc123...

Bot:  å¼€å§‹ä¸‹è½½ç£åŠ›é“¾æ¥...

[ç”¨æˆ·å‘é€ /status æŸ¥çœ‹è¿›åº¦]

Bot:  ğŸ“Š ä¸‹è½½ä»»åŠ¡çŠ¶æ€

      ä»»åŠ¡ #1: ç£åŠ›é“¾æ¥
      â”œâ”€ è¿›åº¦: â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘ 35% (350MB / 1.0GB)
      â”œâ”€ é€Ÿåº¦: 8.5MB/s
      â””â”€ é¢„è®¡: å‰©ä½™ 1åˆ†20ç§’

      æ€»è®¡: 1ä¸ªæ´»è·ƒä»»åŠ¡

[ç­‰å¾…ä¸‹è½½å®Œæˆ]

Bot:  ä¸‹è½½å®Œæˆï¼Œå¼€å§‹ä¸Šä¼ åˆ°Google Drive...
      ä¸Šä¼ å®Œæˆï¼
      é“¾æ¥: https://drive.google.com/file/d/...
```

## è®¸å¯è¯

ä¸OBCXä¸»é¡¹ç›®ä¿æŒä¸€è‡´

## è´¡çŒ®

æ¬¢è¿æäº¤issueå’Œpull requestï¼
